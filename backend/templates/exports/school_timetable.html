{% extends "exports/base.html" %}

{% block content %}
<h1>{{ timetable.branch.name }}</h1>
<h2>{{ title }}</h2>
<div class="header-info">
    Session: {{ timetable.session.name }} | Shift: {{ timetable.shift.name }}
    {% if timetable.season %} | Season: {{ timetable.season.name }}{% endif %}
</div>

{% for grade_data in grades_data %}
{% for section_data in grade_data.sections_data %}
{% if not forloop.parentloop.first or not forloop.first %}
<div class="section-break"></div>
{% endif %}

<h3 style="margin-top: 20px;">{{ grade_data.grade.name }} - Section {{ section_data.section.name }}</h3>

<table>
    <thead>
        <tr>
            <th>Day</th>
            {% for slot in period_slots %}
            <th>
                P{{ slot.period_number }}<br>
                {{ slot.start_time|time:"H:i" }} - {{ slot.end_time|time:"H:i" }}
            </th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for day in days %}
        <tr>
            <td class="day-cell">{{ day_names|get_item:day }}</td>
            {% for slot in period_slots %}
            <td class="subject-cell">
                {% with entry=section_data.grid|get_item:day|get_item:slot.period_number %}
                {% if entry %}
                <div class="subject-name">{{ entry.subject.short_name|default:entry.subject.name }}</div>
                <div class="teacher-name">{{ entry.teacher.first_name|slice:":1" }}. {{ entry.teacher.last_name }}</div>
                {% else %}
                -
                {% endif %}
                {% endwith %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endfor %}
{% endfor %}
{% endblock %}
